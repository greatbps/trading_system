# 🚀 AI Trading System

> **실시간 주식 분석 및 자동매매 시스템**  
> KIS HTS 조건검색 연동, 다단계 정밀 필터링, 자동화된 매매 실행을 통해 시장을 선도합니다.

## 📋 목차

- [🌟 주요 특징](#-주요-특징)
- [🏗️ 시스템 구조](#️-시스템-구조)
- [🗃️ 데이터베이스 관리](#️-데이터베이스-관리)
- [🔧 설치 및 설정](#-설치-및-설정)
- [🚀 사용법](#-사용법)
- [📊 전략 소개](#-전략-소개)
- [📈 백테스트](#-백테스트)
- [🛡️ 리스크 관리](#️-리스크-관리)
- [🤝 기여하기](#-기여하기)

## 🌟 주요 특징

### 🎯 **스마트 종목 선정 (2-Step Filtering)**
- **1차 필터링 (HTS 연동)**: KIS HTS에 저장된 전략별 조건검색식 결과를 API로 직접 수신하여 시장의 관심주를 빠르게 포착합니다.
- **2차 필터링 (정량적 평가)**: 1차 선정된 종목을 대상으로 뉴스 재료, 차트 패턴, 수급 상황을 종합 분석하여 정량화된 점수를 부여합니다. 일정 점수 이상을 획득한 우량 종목만이 최종 후보군에 오릅니다.

### 💰 **지능형 자동매매**
- **실시간 정밀 매수**: 최종 후보군의 3분봉 데이터를 실시간으로 모니터링하며, 사전에 정의된 구체적인 매수 조건(예: 이동평균선 골든크로스, 거래량 급증)이 충족될 때만 정밀하게 매수를 실행합니다.
- **시간대별 자동 전략 적용**: 자동매매 모드 실행 시, 현재 시간대(장 초반, 장중, 장 마감)에 가장 적합한 매매 전략을 시스템이 자동으로 선택하고 수행합니다.
- **리스크 관리**: 동적 손절/익절, 포지션 사이징 등 고급 리스크 관리 기능을 탑재하여 계좌를 보호합니다.

### 📱 **실시간 스마트 알림**
- **텔레그램 봇**: 매수/매도 신호 발생, 주문 체결, 일일 실현 손익 등 모든 중요한 순간을 놓치지 않도록 실시간 텔레그램 알림을 제공합니다.
- **상세 리포트**: 일일/주간 매매 상세 내역과 수익률 분석 리포트를 자동으로 생성하여 제공합니다.

### 🔄 **완전 자동화 스케줄러**
- **장전 분석**: 매일 장 시작 전, HTS 조건검색식을 통해 1차 종목군을 선정하고 2차 분석을 준비합니다.
- **장중 모니터링**: 실시간으로 최종 후보군을 감시하며 매매 기회를 포착합니다.
- **장후 정리**: 모든 매매 활동을 기록하고, 당일의 성과를 요약하여 리포트를 생성합니다.

## 🏗️ 시스템 구조

```
trading_system/
├── 📁 core/                   # 핵심 비즈니스 로직
│   ├── trading_system.py      # 메인 시스템 (3분봉 모니터링, 매매 신호 감지)
│   ├── scheduler.py           # 시간대별 전략 실행 스케줄러
│   └── ...
│
├── 📁 data_collectors/        # 데이터 수집 모듈
│   ├── kis_collector.py       # KIS API (HTS 조건검색식 결과 수신 포함)
│   └── news_collector.py      # 뉴스 수집
│
├── 📁 analyzers/              # 분석 엔진
│   ├── analysis_engine.py     # 2차 필터링 (뉴스, 차트, 수급) 및 점수화
│   ├── technical_analyzer.py  # 기술적 분석
│   └── ...
│
├── 📁 strategies/             # 매매 전략
│   ├── momentum_strategy.py   # 모멘텀 전략
│   └── ...
│
├── 📁 trading/                # 매매 실행
│   ├── executor.py            # 매매 실행기 (KIS 주문 API 연동)
│   └── ...
│
├── 📁 database/               # 데이터베이스 관리
│   ├── models.py              # 데이터베이스 모델 (테이블 정의)
│   ├── db_operations.py       # CRUD 작업
│   └── ...
│
├── 📁 notifications/          # 알림 시스템
│   ├── telegram_bot.py        # 텔레그램 봇
│   └── ...
│
└── 📁 utils/                  # 유틸리티
    └── logger.py              # 로깅 시스템
```

## 🗃️ 데이터베이스 관리

이 시스템은 모든 데이터를 **PostgreSQL** 데이터베이스에 저장하고 관리합니다. SQLite는 지원하지 않습니다. 데이터베이스는 다음과 같은 핵심 정보를 관리하며, 추후 상세 테이블 설계를 진행할 예정입니다.

-   **거래 내역 (Trades)**: 체결된 모든 매매(매수/매도) 기록 (종목, 가격, 수량, 시간, 수수료 등).
-   **포트폴리오 (Portfolio)**: 현재 보유 중인 종목의 실시간 현황 (평단가, 보유 수량, 현재가, 평가손익 등).
-   **계좌 정보 (Account)**: 예수금, 총 자산, 주문 가능 금액 등 계좌의 상태.
-   **분석 결과 (Analysis Results)**: 각 종목에 대한 2차 필터링 점수 및 분석 데이터.
-   **전략별 종목 (Filtered Stocks)**: 1차 필터링을 통과한 전략별 종목 목록.

## 🔧 설치 및 설정

### 1️⃣ **시스템 요구사항**
- Python 3.9+
- **PostgreSQL 12+**
- 한국투자증권 API 계정 및 HTS에 저장된 조건검색식

### 2️⃣ **설치**
(기존 내용과 동일)

### 3️⃣ **환경 설정**
`.env` 파일에 PostgreSQL 접속 정보를 추가해야 합니다.
```bash
# .env 파일
KIS_APP_KEY=your_kis_app_key_here
KIS_APP_SECRET=your_kis_app_secret_here

# PostgreSQL DB 설정
DB_USER=your_db_user
DB_PASSWORD=your_db_password
DB_HOST=localhost
DB_PORT=5432
DB_NAME=trading_system

# ... 기타 설정
```

### 4️⃣ **데이터베이스 초기화**
```bash
# PostgreSQL DB에 테이블 생성
python scripts/setup_database.py
```

## 🚀 사용법
(기존 내용과 동일)

## 📊 전략 소개

본 시스템의 매매 전략은 **시간 프레임**에 따라 다른 접근 방식을 사용하며, **주요 차트 신호**와 **보조지표**를 조합하여 정밀한 매수/매도 타이밍을 결정합니다.

### ✅ 1. 시간 프레임 구분

| 구분 | 사용 차트 | 활용 목적 |
| :--- | :--- | :--- |
| **단기** | 1분봉, 3분봉, 5분봉, 15분봉 | 타이밍 포착, 스캘핑, 뉴스 실시간 대응 |
| **중기** | 30분봉, 1시간봉, 일봉 | 추세 확인, 눌림목 공략, 상승/하락 시그널 포착 |

### ✅ 2. 주요 차트 신호 (매수·매도 기준)

#### **단기 기준 (3분봉, 5분봉, 15분봉)**

| 구분 | 매수 타이밍 | 매도 타이밍 |
| :--- | :--- | :--- |
| **이평선** | 5EMA가 20EMA 상향 돌파, 이평선 수렴 후 확장 시작 | 5EMA 이탈 시 (예: 1/3 분할 매도), 이평선 역배열 전환 |
| **캔들** | 거래량 동반한 장대양봉, 오전 장 저점 지지 양봉 | 거래량 급감한 음봉, 전 고점 부근 장대음봉 |
| **거래량** | 저항선 돌파 시 거래량 급증, 양봉과 함께 거래량 폭발 | 고점에서 거래량 없이 하락, 이전 양봉 거래량의 50% 이하 |
| **갭** | 갭 상승 후 눌림목 지지 확인 후 매수, 갭 하락 후 반등 시도 | 갭 상승 후 고점에서 매도 물량 출회, 갭 하락 후 지지 실패 |
| **추세선** | 하락추세선 상향 돌파, 상승 추세선 지지 후 반등 | 상승추세선 이탈 + 거래량 증가 |

#### **중기 기준 (일봉, 1시간봉, 30분봉)**

| 구분 | 매수 타이밍 | 매도 타이밍 |
| :--- | :--- | :--- |
| **이평선** | 5일선이 20일선 상향 돌파 (골든크로스) | 5일선 이탈, 20일선 이탈 (데드크로스) |
| **캔들** | 장대양봉으로 전일 고가 돌파, 장중 눌림 후 양봉 전환 | 위꼬리 긴 음봉 출현, 장대음봉으로 주요 지지선 이탈 |
| **거래량** | 박스권 상단 돌파 시 거래량 폭증, 지지선 반등 시 거래량 증가 | 고점 부근에서 거래량 감소, 상승 중 대량 매도 거래 발생 |
| **보조지표** | RSI 30 부근 반등, MACD 골든크로스, Supertrend 상승 전환 | RSI 70 이상에서 하락 반전, MACD 데드크로스, Supertrend 하락 전환 |
| **가격패턴** | 이중바닥(W) 패턴 완성 후 돌파, 삼각수렴 상단 돌파 | 쌍봉(M) 패턴, 헤드앤숄더 패턴 완성 후 이탈 |
| **볼린저밴드**| 중심선 또는 하단선 지지 후 반등 | 상단선 근처에서 저항을 받으며 음봉 출현, 중심선 하향 이탈 |

### ✅ 3. 핵심 보조지표 기준 정리

| 지표 | 활용 방식 | 매수 신호 | 매도 신호 |
| :--- | :--- | :--- | :--- |
| **RSI** | 과매수/과매도 | 30 이하에서 반등 시 | 70 이상에서 하락 반전 |
| **MACD** | 추세 전환 | 골든크로스 발생 (0선 이상에서 신뢰도 높음) | 데드크로스 발생 |
| **Supertrend**| 추세 추종 | 하락 → 상승 전환 시 | 상승 → 하락 전환 시 |
| **EMA** | 단기/중기 추세 | 5EMA > 20EMA 돌파 | 5EMA < 20EMA 이탈 |
| **ATR** | 변동성 (손절/익절) | 저ATR에서 돌파 시 (저점 매수 기회) | 고ATR에서 장대음봉 (단기 피로) |
| **볼린저밴드**| 변동성 및 지지/저항 | 하단 터치 후 반등 | 상단 터치 후 하락 |

### ✅ 4. 실전 적용 예시

-   **단기 트레이딩 예시 (3분봉):**
    -   **매수:** 3분봉 차트에서 5EMA가 20EMA를 골든크로스하고, 거래량이 평균 대비 200% 이상 터지는 순간 매수 진입.
    -   **분할 매도:** 수익권에서 5EMA를 이탈할 때 1/3 매도.
    -   **전량 매도:** 15분봉에서 거래량 없는 장대음봉이 출현하며 추세가 꺾일 때 잔량 매도.

-   **중기 트레이딩 예시 (일봉):**
    -   **매수:** 일봉 차트에서 20일선과 볼린저밴드 중심선의 지지를 확인하며, 거래량이 증가하는 양봉 출현 시 매수.
    -   **매도:** RSI가 70 이상 과매수 구간에 진입하고, MACD 데드크로스가 발생하면 매도.

### ✅ 5. 보조 조건 (필터링)

-   **뉴스/이슈 체크**: 매매 결정 전, 해당 종목의 주요 뉴스를 확인하여 단기 급등락 리스크를 관리.
-   **펀더멘털**: 중기 투자 시, 최소한의 시가총액, 부채비율 등 기본 재무 건전성을 필터링 조건으로 활용.
-   **시장 상황**: 코스피/코스닥 지수의 전반적인 흐름과 비교하여, 지수를 역행하는 종목은 투자 비중을 줄이거나 보수적으로 접근.

### ✅ 6. 요약

| 항목 | 단기 트레이딩 | 중기 트레이딩 |
| :--- | :--- | :--- |
| **주요 차트** | 3분봉, 5분봉, 15분봉 | 30분봉, 일봉 |
| **주요 이평선**| 5EMA, 20EMA | 5일선, 20일선, 60일선 |
| **핵심 지표** | RSI, Supertrend, 거래량 | MACD, 볼린저밴드, RSI |
| **매수 타이밍**| 눌림목 반등, 거래량 동반 돌파 | 추세 전환 확인 (골든크로스), 박스권 돌파 |
| **매도 타이밍**| 이평선 이탈, 거래량 감소 음봉 | 주요 지지선 이탈, 데드크로스 |
| **분할 전략** | 1/3씩 분할 매도/매수 권장 | 1차 진입 후, 지지 확인 시 추가 진입 (불타기) |

### ✅ 7. 뉴스/재료 분석 기준 (2차 필터링)

2차 필터링의 `news_score`는 아래 키워드의 영향력(단기/중기/장기), 가중치, 긍정/부정 점수를 종합하여 산출됩니다.

#### **긍정적 재료 (Positive Factors)**

| 카테고리 | 키워드 | 영향 기간 | 가중치 | 점수 (예시) |
| :--- | :--- | :--- | :--- | :--- |
| **M&A/지배구조** | 인수합병(M&A) 공시 | 단기/중기 | 중 | +15 |
| | 공개매수 | 단기 | 중 | +12 |
| | 회사 분할 (특히 인적분할) | 중기 | 중 | +12 |
| | 자회사 상장 추진 | 단기 | 하 | +8 |
| | 최대 주주/주요 주주 지분 매입 | 장기 | 상 | +20 |
| **신사업/기술** | 신약 개발 임상 결과 발표 (특히 3상) | 단기/중기 | 중 | +15 |
| | 신규 사업 진출 발표 | 단기/중기 | 중 | +12 |
| | 정부 정책 수혜 (보조금, 규제 완화) | 중기 | 중 | +12 |
| | 특허권 취득 | 단기 | 하 | +8 |
| | 글로벌 기업과 전략적 제휴 | 장기 | 상 | +20 |
| **계약/실적** | 대규모 신규 수주 계약 체결 | 단기/중기 | 중 | +15 |
| | 사상 최대 실적 달성 | 중기 | 중 | +12 |
| | 턴어라운드 (흑자전환) | 중기 | 중 | +12 |
| | 단일 판매·공급계약 체결 | 장기 | 상 | +20 |
| **자금/주주환원**| 무상증자 | 단기 | 중 | +15 |
| | 제3자 배정 유상증자 | 단기 | 중 | +12 |
| | 자사주 매입 또는 소각 | 장기 | 상 | +20 |
| | 액면분할 | 장기 | 하 | +8 |
| | 지속적 배당 확대 | 장기 | 하 | +8 |
| **수급/기타** | 기관/외국인 대량 순매수 | 단기 | 중 | +10 |
| | 특정 테마 부각 (AI, 2차전지 등) | 단기 | 중 | +10 |

#### **부정적 재료 (Negative Factors)**

| 카테고리 | 키워드 | 영향 기간 | 가중치 | 점수 (예시) |
| :--- | :--- | :--- | :--- | :--- |
| **재무/자금** | 주주배정 유상증자 | 단기 | 상 | -20 |
| | 전환사채(CB) 발행/전환 | 단기/중기 | 중 | -15 |
| | 실적 악화 (어닝 쇼크) | 중기 | 중 | -15 |
| | 부채비율 급등 / 재무건전성 악화 | 장기 | 상 | -20 |
| **경영/소송** | 횡령·배임 혐의 발생 | 단기/중기 | 상 | -25 |
| | 대표이사 또는 주요 임원 사임 | 단기 | 중 | -10 |
| | 소송 패소 / 규제 당국 조사 | 단기/중기 | 중 | -10 |
| **시장/기타** | 투자경고/거래정지 지정 | 단기 | 상 | -15 |
| | 주요 경쟁사의 기술력 우위 확보 | 중기 | 중 | -10 |
| | 대주주 지분 매도 (오버행 이슈) | 단기/중기 | 상 | -15 |

## 📈 백테스트

## 📈 백테스트

본 시스템의 백테스팅은 과거 데이터를 통해 **특정 전략의 유효성을 검증**하는 것을 목표로 합니다.

-   **프로세스**:
    1.  사용자가 **전략**과 **테스트 기간**을 선택합니다.
    2.  시스템은 해당 기간 동안 매일 **1차/2차 필터링**을 수행하여 백테스트 대상 종목을 선정합니다.
    3.  선정된 종목들에 대해, `전략 소개` 섹션에 기술된 **상세 매수/매도 타이밍 규칙**을 적용하여 가상 매매를 실행합니다.
    4.  모든 가상 매매가 완료되면, 최종적으로 **총 수익률, 승률, 평균 손익비, 최대 낙폭(MDD)** 등의 핵심 성과 지표를 계산하여 보여줍니다.

-   **사용 예시**:
    ```bash
    # '모멘텀 전략'을 2024년 상반기 동안 필터링된 종목에 대해 백테스트 실행
    python main.py --mode backtest --strategy momentum --start 2024-01-01 --end 2024-06-30
    ```

---
(이하 리스크 관리, 기여하기 등 나머지 섹션은 기존 내용과 동일하게 유지됩니다)